-- üå≤ Auto Farm Tree Script (lu√¥n ch·∫∑t c√¢y, kh√¥ng ƒë·ª©ng im)
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local originalCFrame = hrp.CFrame

local Farming = false
local treesFolder = workspace:WaitForChild("Map"):WaitForChild("Landmarks")

-- üö´ Noclip
RunService.Stepped:Connect(function()
	for _, v in pairs(character:GetDescendants()) do
		if v:IsA("BasePart") then
			v.CanCollide = false
		end
	end
end)

-- üñ±Ô∏è Auto click loop
local function autoClickLoop()
	task.spawn(function()
		while Farming do
			VirtualUser:ClickButton1(Vector2.new(0,0))
			task.wait(0.05)
		end
	end)
end

-- üìç Tween nhanh s√°t g·ªëc c√¢y + xoay m·∫∑t
local function tweenTo(tree)
	if not tree or not tree.Parent then return end
	local pos
	if tree:IsA("Model") and tree.PrimaryPart then
		pos = tree.PrimaryPart.Position
	elseif tree:IsA("BasePart") then
		pos = tree.Position
	end
	if not pos then return end

	local lookAt = (pos - hrp.Position).Unit
	local targetPos = pos - lookAt * 4 -- ƒë·ª©ng s√°t m·∫∑t g·ªëc
	local targetCFrame = CFrame.new(targetPos, pos)

	local tween = TweenService:Create(
		hrp,
		TweenInfo.new(0.05, Enum.EasingStyle.Linear),
		{CFrame = targetCFrame}
	)
	tween:Play()
end

-- üîç T√¨m c√¢y g·∫ßn nh·∫•t c√≤n t·ªìn t·∫°i
local function getNearestTree()
	local closest, dist = nil, math.huge
	for _, tree in pairs(treesFolder:GetChildren()) do
		if tree.Name:find("Small Tree") and tree.Parent then
			local pos
			if tree:IsA("Model") and tree.PrimaryPart then
				pos = tree.PrimaryPart.Position
			elseif tree:IsA("BasePart") then
				pos = tree.Position
			end
			if pos then
				local d = (hrp.Position - pos).Magnitude
				if d < dist then
					dist = d
					closest = tree
				end
			end
		end
	end
	return closest
end

-- üîÑ Farm loop (m·ªói 9 gi√¢y ch·∫Øc ch·∫Øn ƒë·ªïi c√¢y)
local function startFarm()
	Farming = true
	autoClickLoop()

	task.spawn(function()
		while Farming do
			local tree = getNearestTree()
			if tree then
				tweenTo(tree)
				-- ƒë·ª©ng 9 gi√¢y
				for i = 1, 90 do
					if not Farming then break end
					if not tree or not tree.Parent then break end -- c√¢y bi·∫øn m·∫•t th√¨ break s·ªõm
					task.wait(0.1)
				end
			else
				-- n·∫øu kh√¥ng c√≥ c√¢y n√†o, ch·ªù 10s r·ªìi t√¨m l·∫°i
				for i = 1, 100 do
					if not Farming then break end
					task.wait(0.1)
				end
			end
		end
		-- tr·∫£ v·ªÅ v·ªã tr√≠ c≈© khi ng∆∞ng
		hrp.CFrame = originalCFrame
	end)
end

local function stopFarm()
	Farming = false
end

-- üü¢ GUI Toggle
local gui = Instance.new("ScreenGui", player.PlayerGui)
local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 180, 0, 50)
button.Position = UDim2.new(0, 20, 0, 20)
button.Text = "Start Auto Farm"
button.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
button.Parent = gui

button.MouseButton1Click:Connect(function()
	if not Farming then
		button.Text = "Stop Auto Farm"
		button.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
		startFarm()
	else
		button.Text = "Start Auto Farm"
		button.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
		stopFarm()
	end
end)
